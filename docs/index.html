<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="theme-color" content="#000000" />

    <title>React App</title>
    <style>
      .widget-holder {
        border: 1px solid gray;
      }
      .disabled {
        visibility: hidden;
        height: 0px;
      }
      .enabled {
        visibility: visible;
        height: auto;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <h1>Main Page</h1>
    <div style="max-width: 400px; max-height: 200px; overflow: auto;">
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Orci sagittis eu
        volutpat odio facilisis mauris. Massa massa ultricies mi quis hendrerit
        dolor. Sem viverra aliquet eget sit amet tellus cras adipiscing enim.
        Tristique nulla aliquet enim tortor. Lacus viverra vitae congue eu
        consequat ac felis donec et. Sit amet aliquam id diam maecenas ultricies
        mi eget. Dolor morbi non arcu risus quis varius quam quisque id.
        Pharetra magna ac placerat vestibulum lectus mauris. Pharetra vel turpis
        nunc eget. Id velit ut tortor pretium viverra suspendisse potenti
        nullam. Sit amet nulla facilisi morbi tempus. Tristique senectus et
        netus et. Mattis aliquam faucibus purus in. Neque aliquam vestibulum
        morbi blandit cursus risus at ultrices. A condimentum vitae sapien
        pellentesque habitant morbi tristique senectus. Egestas tellus rutrum
        tellus pellentesque eu tincidunt tortor aliquam nulla. Adipiscing at in
        tellus integer feugiat scelerisque varius. Amet purus gravida quis
        blandit turpis cursus in hac.
      </p>
    </div>
    <br />
    <p>
      <span>User Name:</span>
      <input type="text" name="" id="user-name" value="Lee Kuan Yew" />
    </p>
    <br />
    <span id="widget-data">no data</span> <br />
    <br />
    <button id="widget-enable">Load widget</button>
    <hr />
    <div id="widget-holder" class="widget-holder disabled">
      <iframe id="widget-iframe" frameborder="0"></iframe>
      <hr />
    </div>
    <a href="https://usulpro.github.io/widget-page/" target="_blank">open on a separate page</a>

    <script>
      const WIDGET_URL = 'https://usulpro.github.io/widget-page/';
      const dataSpan = document.getElementById('widget-data');
      const widgetButton = document.getElementById('widget-enable');
      const widgetIFrame = document.getElementById('widget-iframe');
      const widgetHolder = document.getElementById('widget-holder');
      const userNameInput = document.getElementById('user-name');

      const sendToInitChannel = data => {
        widgetIFrame.contentWindow.postMessage(
          {
            messageType: 'INIT',
            ...data,
          },
          '*'
        );
      };

      const onInitChannel = data => {
        widgetHolder.classList.add('enabled');
        dataSpan.innerText = data.widgetName;
        const userName = userNameInput.value || 'Lee Kuan Yew';
        sendToInitChannel({ userName });
      };

      const onDataChannel = data => {
        dataSpan.innerText = JSON.stringify(data);
      };

      const onChannel = e => {
        const data = e.data;
        if (data.messageType === 'INIT') {
          onInitChannel(data);
        };
        if (data.messageType === 'DATA') {
          onDataChannel(data);
        }
      };

      window.addEventListener('message', onChannel);
      widgetButton.onclick = () => {
        console.log('loading...');
        widgetIFrame.src = WIDGET_URL;
      };
    </script>
  </body>
</html>
